{
  "permissions": {
    "allow": [
      "Bash(python convert_powerset.py:*)",
      "Bash(python batch_convert_defense_sets.py:*)",
      "Bash(git commit:*)",
      "Bash(git add:*)",
      "Bash(git reset:*)",
      "Bash(ls:*)",
      "Bash(grep:*)",
      "Bash(wc:*)",
      "Bash(tree:*)",
      "Bash(git push:*)",
      "Bash(npm run lint)",
      "Bash(npm install:*)",
      "Bash(npm run build:*)",
      "Bash(node scripts/convert-io-sets.js:*)",
      "Bash(node scripts/convert-powers.js:*)",
      "Bash(git -C \"c:\\\\Projects\\\\CoH-Planner\" log --oneline -20)",
      "Bash(git -C \"c:\\\\Projects\\\\CoH-Planner\" log --all --oneline --grep=\"enhancement\" -i)",
      "Bash(git -C \"c:\\\\Projects\\\\CoH-Planner\" show enhancement-icons-fix:legacy/js/icons.js)",
      "Bash(git -C \"c:\\\\Projects\\\\CoH-Planner\" branch -a)",
      "Bash(git -C \"c:\\\\Projects\\\\CoH-Planner\" show 2bafe53:legacy/js/icons.js)",
      "Bash(npx tsc:*)",
      "Bash(dir /s /b \"c:\\\\Projects\\\\CoH-Planner\\\\public\\\\img\\\\*HO*.png\")",
      "Bash(node -e:*)",
      "Bash(node process_recipes.js:*)",
      "Bash(npm create:*)",
      "Bash(dir \"C:\\\\Projects\\\\CoH-Planner\\\\img\\\\Enhancements\" /b)",
      "Bash(if not exist public mkdir public)",
      "Bash(xcopy:*)",
      "Bash(while read f)",
      "Bash(do echo \"$f\")",
      "Bash(done)",
      "Bash(node scripts/fix-icon-names.js:*)",
      "Bash(node scripts/fix-icon-names.cjs:*)",
      "Bash(for file in \"C:\\\\Projects\\\\legacy-CoH-Planner\\\\js\\\\data\\\\epics\\\\sentinel\"\"*.js; do echo \"=== $file ===\" && cat \"$file \")",
      "Bash(node scripts/convert-epic-pools.js:*)",
      "Bash(xargs:*)",
      "Bash(do git add \"$f\")",
      "Bash(powershell -Command:*)",
      "Bash(git config:*)",
      "Bash(timeout 5 npm run dev:*)",
      "Bash(npx tsx:*)",
      "Bash(dir \"c:\\\\Projects\\\\CoH-Planner\\\\public\\\\img\\\\Powers\" /b)",
      "Bash(python3:*)",
      "Bash(npm run dev:*)",
      "Bash(curl:*)",
      "Bash(netstat:*)",
      "Bash(dir:*)",
      "Bash(node scripts/convert-epic-powersets.js:*)",
      "Bash(node scripts/convert-powerset.js:*)",
      "Bash(node scripts/convert-powerset.cjs:*)",
      "Bash(node scripts/extract-at-tables.cjs:*)",
      "Bash(for dir in blaster_ranged blaster_support brute_defense brute_melee controller_buff controller_control corruptor_buff corruptor_ranged defender_buff defender_ranged dominator_assault dominator_control mastermind_buff mastermind_summon scrapper_defense scrapper_melee sentinel_defense sentinel_ranged stalker_defense stalker_melee tanker_defense tanker_melee)",
      "Bash(do echo \"=== $dir ===\" ls \"C:/Projects/Raw Data Homecoming/powers/$dir/\")",
      "Bash(node scripts/convert-all-powersets.cjs:*)",
      "Bash(node scripts/generate-powerset-index.cjs:*)",
      "Bash(node scripts/convert-epic-powersets-to-modular.cjs:*)",
      "Bash(echo:*)",
      "Bash(npm run type-check:*)",
      "Bash(tee:*)",
      "Bash(\"c:\\\\Projects\\\\CoH-Planner\\\\_update_all.ps1\":*)",
      "Bash(git status:*)",
      "Bash(/tmp/add-damage-blocks.js << 'SCRIPT'\nconst fs = require\\('fs'\\);\nconst path = require\\('path'\\);\n\nconst DAMAGE_DATA = {\n  'sonic-thrust': { type: 'Energy', scale: 0.76, table: 'Melee_Damage' },\n  'strident-echo': { type: 'Energy', scale: 0.22, table: 'Melee_Damage', duration: 2.1, tickRate: 0.4 },\n  'sonic-clap': { type: 'Energy', scale: 0.78, table: 'Melee_Damage' },\n  'earsplitter': { type: 'Energy', scale: 2.6, table: 'Melee_Damage' },\n  'deafening-wave': { type: 'Energy', scale: 0.85, table: 'Melee_Damage' },\n  'sandman-s-whisper': { type: 'Energy', scale: 1.64, table: 'Melee_Damage' },\n};\n\nconst AT_DIRS = [\n  'c:/Projects/CoH-Planner/src/data/powersets/scrapper/primary/sonic-melee/',\n  'c:/Projects/CoH-Planner/src/data/powersets/brute/primary/sonic-melee/',\n  'c:/Projects/CoH-Planner/src/data/powersets/stalker/primary/sonic-melee/',\n  'c:/Projects/CoH-Planner/src/data/powersets/tanker/secondary/sonic-melee/',\n];\n\nlet modifiedCount = 0;\nconst modifiedFiles = [];\n\nfor \\(const dir of AT_DIRS\\) {\n  for \\(const [powerName, damageInfo] of Object.entries\\(DAMAGE_DATA\\)\\) {\n    const filePath = path.join\\(dir, `${powerName}.ts`\\);\n\n    if \\(!fs.existsSync\\(filePath\\)\\) {\n      console.log\\(`SKIP \\(not found\\): ${filePath}`\\);\n      continue;\n    }\n\n    let content = fs.readFileSync\\(filePath, 'utf-8'\\);\n\n    // Build the damage block lines\n    const lines = [];\n    lines.push\\(`    \"type\": \"${damageInfo.type}\"`\\);\n    lines.push\\(`    \"scale\": ${damageInfo.scale}`\\);\n    lines.push\\(`    \"table\": \"${damageInfo.table}\"`\\);\n    if \\(damageInfo.duration !== undefined\\) {\n      lines.push\\(`    \"duration\": ${damageInfo.duration}`\\);\n      lines.push\\(`    \"tickRate\": ${damageInfo.tickRate}`\\);\n    }\n\n    // Join with commas between all but last line\n    const damageBlock = lines.map\\(\\(line, i\\) => {\n      return i < lines.length - 1 ? line + ',' : line;\n    }\\).join\\('\\\\n'\\);\n\n    const replacement = `\"maxSlots\": 6,\\\\n  \"damage\": {\\\\n${damageBlock}\\\\n  }\\\\n};`;\n\n    const newContent = content.replace\\(/\"maxSlots\": 6\\\\n};/, replacement\\);\n\n    if \\(newContent === content\\) {\n      console.log\\(`SKIP \\(pattern not found\\): ${filePath}`\\);\n      continue;\n    }\n\n    fs.writeFileSync\\(filePath, newContent, 'utf-8'\\);\n    modifiedCount++;\n    modifiedFiles.push\\(filePath\\);\n    console.log\\(`MODIFIED: ${filePath}`\\);\n  }\n}\n\nconsole.log\\(`\\\\nTotal files modified: ${modifiedCount}`\\);\nconsole.log\\('\\\\nModified files:'\\);\nmodifiedFiles.forEach\\(f => console.log\\(`  ${f}`\\)\\);\nSCRIPT)",
      "Bash(npx:*)",
      "Bash(\"c:/Projects/CoH-Planner/scripts/patch-slice.cjs\" << 'SCRIPT'\nconst fs = require\\('fs'\\);\nconst path = require\\('path'\\);\n\nconst files = [\n  {\n    path: path.resolve\\(__dirname, '../src/data/powersets/scrapper/primary/broad-sword/slice.ts'\\),\n    archetype: 'Scrapper',\n    isStalker: false,\n  },\n  {\n    path: path.resolve\\(__dirname, '../src/data/powersets/brute/primary/broad-sword/slice.ts'\\),\n    archetype: 'Brute',\n    isStalker: false,\n  },\n  {\n    path: path.resolve\\(__dirname, '../src/data/powersets/stalker/primary/broad-sword/slice.ts'\\),\n    archetype: 'Stalker',\n    isStalker: true,\n  },\n  {\n    path: path.resolve\\(__dirname, '../src/data/powersets/tanker/secondary/broad-sword/slice.ts'\\),\n    archetype: 'Tanker',\n    isStalker: false,\n  },\n];\n\nfor \\(const file of files\\) {\n  console.log\\(`\\\\n=== Patching ${file.archetype} \\(${file.path}\\) ===`\\);\n  let content = fs.readFileSync\\(file.path, 'utf-8'\\);\n  let changeCount = 0;\n\n  // 1. JSDoc comment: -DEF -> -DEF, -Res\n  {\n    const before = content;\n    content = content.replace\\(\n      /\\(\\\\* Melee \\\\\\(Cone\\\\\\), DMG\\\\\\(Lethal\\\\\\), Foe -DEF\\)\\\\b\\(?!, -Res\\)/,\n      '$1, -Res'\n    \\);\n    if \\(content !== before\\) {\n      console.log\\(`  [1] Updated JSDoc comment to include -Res`\\);\n      changeCount++;\n    }\n  }\n\n  // 2. shortHelp: -DEF -> -DEF, -Res\n  {\n    const before = content;\n    content = content.replace\\(\n      /\"shortHelp\": \"Melee \\\\\\(Cone\\\\\\), DMG\\\\\\(Lethal\\\\\\), Foe -DEF\"/,\n      '\"shortHelp\": \"Melee \\(Cone\\), DMG\\(Lethal\\), Foe -DEF, -Res\"'\n    \\);\n    if \\(content !== before\\) {\n      console.log\\(`  [2] Updated shortHelp to include -Res`\\);\n      changeCount++;\n    }\n  }\n\n  // 3. castTime: 2 -> 1.83 \\(match exactly \"castTime\": 2, not 2.something\\)\n  {\n    const before = content;\n    content = content.replace\\(\n      /\"castTime\": 2,/,\n      '\"castTime\": 1.83,'\n    \\);\n    if \\(content !== before\\) {\n      console.log\\(`  [3] Updated castTime from 2 to 1.83`\\);\n      changeCount++;\n    }\n  }\n\n  // 5. Replace entire effects block \\(handles change 4 as well: defenseDebuff scale 1 -> 0.5\\)\n  {\n    const before = content;\n    const effectsRegex = /\"effects\": \\\\{\\\\s*\"defenseDebuff\": \\\\{\\\\s*\"scale\": 1,\\\\s*\"table\": \"Melee_Debuff_Def\"\\\\s*\\\\}\\\\s*\\\\}/;\n    const replacement = `\"effects\": {\n    \"defenseDebuff\": {\n      \"scale\": 0.5,\n      \"table\": \"Melee_Debuff_Def\"\n    },\n    \"resistanceDebuff\": {\n      \"scale\": 1.2,\n      \"table\": \"Melee_Debuff_Res_Dmg\"\n    }\n  }`;\n    content = content.replace\\(effectsRegex, replacement\\);\n    if \\(content !== before\\) {\n      console.log\\(`  [4] Updated defenseDebuff scale from 1 to 0.5`\\);\n      console.log\\(`  [5] Added resistanceDebuff effect \\(scale: 1.2, table: Melee_Debuff_Res_Dmg\\)`\\);\n      changeCount += 2;\n    }\n  }\n\n  // 6. For Scrapper, Brute, Tanker ONLY: first damage \"scale\": 1.23 -> 1.2346\n  if \\(!file.isStalker\\) {\n    const before = content;\n    // Match the first occurrence of \"scale\": 1.23 that is followed by Melee_Damage \\(not InherentDamage\\)\n    // The structure is: { \"type\": \"Lethal\", \"scale\": 1.23, \"table\": \"Melee_Damage\" }\n    content = content.replace\\(\n      /\\(\"type\": \"Lethal\",\\\\s*\"scale\": \\)1\\\\.23\\(,\\\\s*\"table\": \"Melee_Damage\"\\)/,\n      '$11.2346$2'\n    \\);\n    if \\(content !== before\\) {\n      console.log\\(`  [6] Updated first damage scale from 1.23 to 1.2346 \\(Melee_Damage/Lethal\\)`\\);\n      changeCount++;\n    }\n  } else {\n    console.log\\(`  [6] Skipped damage scale change \\(Stalker already has 1.2346\\)`\\);\n  }\n\n  // 7. For Stalker ONLY: maxTargets 5 -> 10\n  if \\(file.isStalker\\) {\n    const before = content;\n    content = content.replace\\(\n      /\"maxTargets\": 5/,\n      '\"maxTargets\": 10'\n    \\);\n    if \\(content !== before\\) {\n      console.log\\(`  [7] Updated maxTargets from 5 to 10`\\);\n      changeCount++;\n    }\n  }\n\n  fs.writeFileSync\\(file.path, content, 'utf-8'\\);\n  console.log\\(`  Total changes applied: ${changeCount}`\\);\n}\n\nconsole.log\\('\\\\nAll files patched successfully.'\\);\nSCRIPT)",
      "Bash(\"c:/Projects/CoH-Planner/scripts/patch-elec-melee.cjs\" << 'SCRIPT_EOF'\n/**\n * patch-elec-melee.cjs\n *\n * Applies Electrical Melee balance changes:\n *\n * 1. Jacob's Ladder \\(all 4 ATs\\):\n *    - recharge: 8 -> 9\n *    - endurance: 8.528 -> 9.36\n *    - damage scale: 1.5 -> 1.5233 \\(Energy entry only\\)\n *\n * 2. Chain Induction \\(all 4 ATs\\):\n *    - allowedSetCategories: \"Melee Damage\" -> \"Melee AoE Damage\"\n */\n\nconst fs = require\\('fs'\\);\nconst path = require\\('path'\\);\n\nconst BASE = path.resolve\\(__dirname, '..', 'src', 'data', 'powersets'\\);\n\nconst atDirs = [\n  path.join\\(BASE, 'scrapper', 'primary', 'electrical-melee'\\),\n  path.join\\(BASE, 'brute', 'primary', 'electrical-melee'\\),\n  path.join\\(BASE, 'stalker', 'primary', 'electrical-melee'\\),\n  path.join\\(BASE, 'tanker', 'secondary', 'electrical-melee'\\),\n];\n\nlet totalChanges = 0;\n\n// --- Jacob's Ladder ---------------------------------------------------------\n\nfor \\(const dir of atDirs\\) {\n  const filePath = path.join\\(dir, 'jacobs-ladder.ts'\\);\n  const parts = dir.split\\(path.sep\\);\n  const psIdx = parts.indexOf\\('powersets'\\);\n  const at = psIdx >= 0 ? parts[psIdx + 1] : 'unknown';\n\n  console.log\\('\\\\n=== Jacob\\\\'s Ladder [' + at + '] ==='\\);\n  console.log\\('  File: ' + filePath\\);\n\n  let content = fs.readFileSync\\(filePath, 'utf-8'\\);\n  let changes = 0;\n\n  // 1a. recharge: 8 -> 9\n  {\n    const re = /\\(\"recharge\":\\\\s*\\)8\\(\\\\s*[,\\\\n}]\\)/;\n    const match = content.match\\(re\\);\n    if \\(match\\) {\n      content = content.replace\\(re, '$19$2'\\);\n      changes++;\n      console.log\\('  [OK] recharge: 8 -> 9'\\);\n    } else {\n      console.log\\('  [SKIP] recharge: 8 not found \\(may already be patched\\)'\\);\n    }\n  }\n\n  // 1b. endurance: 8.528 -> 9.36\n  {\n    const re = /\\(\"endurance\":\\\\s*\\)8\\\\.528/;\n    const match = content.match\\(re\\);\n    if \\(match\\) {\n      content = content.replace\\(re, '$19.36'\\);\n      changes++;\n      console.log\\('  [OK] endurance: 8.528 -> 9.36'\\);\n    } else {\n      console.log\\('  [SKIP] endurance: 8.528 not found \\(may already be patched\\)'\\);\n    }\n  }\n\n  // 1c. damage scale 1.5 -> 1.5233 for the Energy damage entry only\n  //     Match \"type\": \"Energy\" followed shortly by \"scale\": 1.5\n  {\n    const re = /\\(\"type\":\\\\s*\"Energy\",\\\\s*\\\\n\\\\s*\"scale\":\\\\s*\\)1\\\\.5\\(\\\\s*,\\)/;\n    const match = content.match\\(re\\);\n    if \\(match\\) {\n      content = content.replace\\(re, '$11.5233$2'\\);\n      changes++;\n      console.log\\('  [OK] damage scale \\(Energy\\): 1.5 -> 1.5233'\\);\n    } else {\n      console.log\\('  [SKIP] damage scale 1.5 near \"type\": \"Energy\" not found \\(may already be patched\\)'\\);\n    }\n  }\n\n  if \\(changes > 0\\) {\n    fs.writeFileSync\\(filePath, content, 'utf-8'\\);\n    console.log\\('  Wrote ' + changes + ' change\\(s\\).'\\);\n  } else {\n    console.log\\('  No changes written.'\\);\n  }\n  totalChanges += changes;\n}\n\n// --- Chain Induction --------------------------------------------------------\n\nfor \\(const dir of atDirs\\) {\n  const filePath = path.join\\(dir, 'chain-induction.ts'\\);\n  const parts = dir.split\\(path.sep\\);\n  const psIdx = parts.indexOf\\('powersets'\\);\n  const at = psIdx >= 0 ? parts[psIdx + 1] : 'unknown';\n\n  console.log\\('\\\\n=== Chain Induction [' + at + '] ==='\\);\n  console.log\\('  File: ' + filePath\\);\n\n  let content = fs.readFileSync\\(filePath, 'utf-8'\\);\n  let changes = 0;\n\n  // 2. Replace \"Melee Damage\" with \"Melee AoE Damage\" in allowedSetCategories\n  {\n    const re = /\"Melee Damage\"/g;\n    const matches = content.match\\(re\\);\n    if \\(matches && matches.length > 0\\) {\n      content = content.replace\\(re, '\"Melee AoE Damage\"'\\);\n      changes += matches.length;\n      console.log\\('  [OK] \"Melee Damage\" -> \"Melee AoE Damage\" \\(' + matches.length + ' occurrence\\(s\\)\\)'\\);\n    } else {\n      console.log\\('  [SKIP] \"Melee Damage\" not found \\(may already be patched\\)'\\);\n    }\n  }\n\n  if \\(changes > 0\\) {\n    fs.writeFileSync\\(filePath, content, 'utf-8'\\);\n    console.log\\('  Wrote ' + changes + ' change\\(s\\).'\\);\n  } else {\n    console.log\\('  No changes written.'\\);\n  }\n  totalChanges += changes;\n}\n\nconsole.log\\('\\\\n=== Done. Total changes applied: ' + totalChanges + ' ===\\\\n'\\);\nSCRIPT_EOF)",
      "Bash(\"c:/Projects/CoH-Planner/scripts/patch-psi-melee.cjs\" << 'SCRIPT_EOF'\n/**\n * Patch script for Psionic Melee changes:\n * 1. Insight DoT standardization \\(scale + duration changes\\)\n * 2. Boggle castTime reduction\n * 3. Greater Psi Blade Insight scale buff + hold mag reduction\n */\n\nconst fs = require\\('fs'\\);\nconst path = require\\('path'\\);\n\nconst BASE = path.resolve\\(__dirname, '..', 'src', 'data', 'powersets'\\);\n\nconst AT_DIRS = [\n  path.join\\(BASE, 'scrapper', 'primary', 'psionic-melee'\\),\n  path.join\\(BASE, 'brute', 'primary', 'psionic-melee'\\),\n  path.join\\(BASE, 'stalker', 'primary', 'psionic-melee'\\),\n  path.join\\(BASE, 'tanker', 'secondary', 'psionic-melee'\\),\n];\n\nlet totalChanges = 0;\n\nfunction log\\(msg\\) {\n  console.log\\('  [PATCH] ' + msg\\);\n}\n\n// --- 1. Insight DoT standardization ---\n\nconst DOT_POWERS = [\n  { file: 'mental-strike.ts',    oldScale: 0.084,  newScale: 0.0661 },\n  { file: 'psi-blade.ts',        oldScale: 0.2285, newScale: 0.1799 },\n  { file: 'telekinetic-blow.ts', oldScale: 0.18,   newScale: 0.1417 },\n  { file: 'psi-blade-sweep.ts',  oldScale: 0.236,  newScale: 0.1858 },\n  { file: 'mass-levitate.ts',    oldScale: 0.142,  newScale: 0.1118 },\n];\n\nconsole.log\\('\\\\n=== 1. Insight DoT Standardization ===\\\\n'\\);\n\nfor \\(const atDir of AT_DIRS\\) {\n  const atName = atDir.split\\(path.sep\\).slice\\(-3, -1\\).join\\('/'\\);\n\n  for \\(const power of DOT_POWERS\\) {\n    const filePath = path.join\\(atDir, power.file\\);\n\n    if \\(!fs.existsSync\\(filePath\\)\\) {\n      log\\('SKIP ' + atName + '/' + power.file + ' \\(file does not exist\\)'\\);\n      continue;\n    }\n\n    let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n    const oldScaleStr = String\\(power.oldScale\\);\n    const newScaleStr = String\\(power.newScale\\);\n\n    // Escape dots for regex\n    const escapedOldScale = oldScaleStr.replace\\(/\\\\./g, '\\\\\\\\.'\\);\n\n    // Match an object block { ... } containing both the old scale and duration 3.1\n    // Use [\\\\s\\\\S]*? for multi-line matching inside the braces\n    const blockRegex = new RegExp\\(\n      '\\\\\\\\{[\\\\\\\\s\\\\\\\\S]*?\"scale\":\\\\\\\\s*' + escapedOldScale + '[\\\\\\\\s\\\\\\\\S]*?\"duration\":\\\\\\\\s*3\\\\\\\\.1[\\\\\\\\s\\\\\\\\S]*?\\\\\\\\}',\n      'g'\n    \\);\n\n    const matches = content.match\\(blockRegex\\);\n    if \\(matches && matches.length === 1\\) {\n      let newBlock = matches[0];\n      // Replace scale\n      newBlock = newBlock.replace\\(\n        new RegExp\\('\"scale\":\\\\\\\\s*' + escapedOldScale\\),\n        '\"scale\": ' + newScaleStr\n      \\);\n      // Replace duration\n      newBlock = newBlock.replace\\(/\"duration\":\\\\s*3\\\\.1/, '\"duration\": 2.1'\\);\n\n      content = content.replace\\(matches[0], newBlock\\);\n      fs.writeFileSync\\(filePath, content, 'utf8'\\);\n      log\\('UPDATED ' + atName + '/' + power.file + ': scale ' + oldScaleStr + ' -> ' + newScaleStr + ', duration 3.1 -> 2.1'\\);\n      totalChanges++;\n    } else if \\(matches && matches.length > 1\\) {\n      log\\('WARNING ' + atName + '/' + power.file + ': found ' + matches.length + ' matching blocks, skipping for safety'\\);\n    } else {\n      log\\('SKIP ' + atName + '/' + power.file + ' \\(no matching DoT entry with scale ' + oldScaleStr + ' and duration 3.1\\)'\\);\n    }\n  }\n}\n\n// --- 2. Boggle castTime ---\n\nconsole.log\\('\\\\n=== 2. Boggle castTime Change ===\\\\n'\\);\n\nfor \\(const atDir of AT_DIRS\\) {\n  const atName = atDir.split\\(path.sep\\).slice\\(-3, -1\\).join\\('/'\\);\n  const filePath = path.join\\(atDir, 'boggle.ts'\\);\n\n  if \\(!fs.existsSync\\(filePath\\)\\) {\n    log\\('SKIP ' + atName + '/boggle.ts \\(file does not exist\\)'\\);\n    continue;\n  }\n\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  // Match \"castTime\": 2 followed by comma or whitespace \\(but not 2.5 etc.\\)\n  const castTimeRegex = /\"castTime\":\\\\s*2\\([,\\\\s]\\)/;\n  const match = content.match\\(castTimeRegex\\);\n\n  if \\(match\\) {\n    content = content.replace\\(castTimeRegex, '\"castTime\": 1' + match[1]\\);\n    fs.writeFileSync\\(filePath, content, 'utf8'\\);\n    log\\('UPDATED ' + atName + '/boggle.ts: castTime 2 -> 1'\\);\n    totalChanges++;\n  } else {\n    log\\('SKIP ' + atName + '/boggle.ts \\(castTime 2 not found\\)'\\);\n  }\n}\n\n// --- 3. Greater Psi Blade ---\n\nconsole.log\\('\\\\n=== 3. Greater Psi Blade Changes ===\\\\n'\\);\n\nfor \\(const atDir of AT_DIRS\\) {\n  const atName = atDir.split\\(path.sep\\).slice\\(-3, -1\\).join\\('/'\\);\n  const filePath = path.join\\(atDir, 'greater-psi-blade.ts'\\);\n\n  if \\(!fs.existsSync\\(filePath\\)\\) {\n    log\\('SKIP ' + atName + '/greater-psi-blade.ts \\(file does not exist\\)'\\);\n    continue;\n  }\n\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n  let changed = false;\n\n  // 3a. Change \"scale\": 1.38 to \"scale\": 1.656 \\(Insight Psionic damage entry\\)\n  const scaleRegex = /\"scale\":\\\\s*1\\\\.38\\([,\\\\s]\\)/;\n  if \\(scaleRegex.test\\(content\\)\\) {\n    content = content.replace\\(scaleRegex, '\"scale\": 1.656$1'\\);\n    log\\('UPDATED ' + atName + '/greater-psi-blade.ts: Insight scale 1.38 -> 1.656'\\);\n    changed = true;\n  } else {\n    log\\('SKIP ' + atName + '/greater-psi-blade.ts: scale 1.38 not found'\\);\n  }\n\n  // 3b. Change hold mag from 3 to 1\n  // Use multi-line aware pattern for \"hold\": { ... \"mag\": 3\n  const holdMagRegex = /\\(\"hold\":\\\\s*\\\\{[\\\\s\\\\S]*?\"mag\":\\\\s*\\)3/;\n  if \\(holdMagRegex.test\\(content\\)\\) {\n    content = content.replace\\(holdMagRegex, '$11'\\);\n    log\\('UPDATED ' + atName + '/greater-psi-blade.ts: hold mag 3 -> 1'\\);\n    changed = true;\n  } else {\n    log\\('SKIP ' + atName + '/greater-psi-blade.ts: hold with mag 3 not found'\\);\n  }\n\n  if \\(changed\\) {\n    fs.writeFileSync\\(filePath, content, 'utf8'\\);\n    totalChanges++;\n  }\n}\n\nconsole.log\\('\\\\n=== Done! Total files changed: ' + totalChanges + ' ===\\\\n'\\);\nSCRIPT_EOF)",
      "Bash(git -C c:/Projects/CoH-Planner diff --stat)",
      "Bash(\"c:/Projects/CoH-Planner/scripts/patch-spines-fiery.cjs\" << 'ENDOFSCRIPT'\n/**\n * Patch script for Spines and Fiery Melee powerset balance changes.\n *\n * Spines: Barb Swipe, Lunge, Spine Burst, Ripper, Throw Spines\n * Fiery Melee: Breath of Fire, Greater Fire Sword\n *\n * Usage: node scripts/patch-spines-fiery.cjs\n */\n\nconst fs = require\\('fs'\\);\nconst path = require\\('path'\\);\n\nconst BASE = path.resolve\\(__dirname, '..', 'src', 'data', 'powersets'\\);\n\n// AT directories for Spines\nconst SPINES_DIRS = [\n  path.join\\(BASE, 'scrapper', 'primary', 'spines'\\),\n  path.join\\(BASE, 'brute', 'primary', 'spines'\\),\n  path.join\\(BASE, 'stalker', 'primary', 'spines'\\),\n  path.join\\(BASE, 'tanker', 'secondary', 'spines'\\),\n];\n\n// AT directories for Fiery Melee\nconst FIERY_MELEE_DIRS = [\n  path.join\\(BASE, 'scrapper', 'primary', 'fiery-melee'\\),\n  path.join\\(BASE, 'brute', 'primary', 'fiery-melee'\\),\n  path.join\\(BASE, 'stalker', 'primary', 'fiery-melee'\\),\n  path.join\\(BASE, 'tanker', 'secondary', 'fiery-melee'\\),\n];\n\nconst FIERY_MELEE_NON_TANKER_DIRS = FIERY_MELEE_DIRS.filter\\(d => !d.includes\\('tanker'\\)\\);\nconst FIERY_MELEE_TANKER_DIR = FIERY_MELEE_DIRS.find\\(d => d.includes\\('tanker'\\)\\);\n\nlet totalChanges = 0;\n\n/**\n * Apply a single text replacement and log it.\n * Returns the new content. Warns if the pattern was not found.\n */\nfunction applyReplace\\(content, filePath, searchPattern, replacement, description\\) {\n  let newContent;\n  if \\(searchPattern instanceof RegExp\\) {\n    if \\(!searchPattern.test\\(content\\)\\) {\n      console.warn\\('  WARNING: Pattern not found for \"' + description + '\" in ' + filePath\\);\n      return content;\n    }\n    newContent = content.replace\\(searchPattern, replacement\\);\n  } else {\n    if \\(!content.includes\\(searchPattern\\)\\) {\n      console.warn\\('  WARNING: Pattern not found for \"' + description + '\" in ' + filePath\\);\n      return content;\n    }\n    newContent = content.replace\\(searchPattern, replacement\\);\n  }\n\n  if \\(newContent === content\\) {\n    console.warn\\('  WARNING: No change after replacement for \"' + description + '\" in ' + filePath\\);\n    return content;\n  }\n\n  totalChanges++;\n  console.log\\('  [OK] ' + description\\);\n  return newContent;\n}\n\n/**\n * Replace ONLY the first occurrence of a literal string.\n */\nfunction replaceFirst\\(content, filePath, search, replacement, description\\) {\n  const idx = content.indexOf\\(search\\);\n  if \\(idx === -1\\) {\n    console.warn\\('  WARNING: Pattern not found for \"' + description + '\" in ' + filePath\\);\n    return content;\n  }\n  const newContent = content.substring\\(0, idx\\) + replacement + content.substring\\(idx + search.length\\);\n  if \\(newContent === content\\) {\n    console.warn\\('  WARNING: No change after replacement for \"' + description + '\" in ' + filePath\\);\n    return content;\n  }\n  totalChanges++;\n  console.log\\('  [OK] ' + description\\);\n  return newContent;\n}\n\n// ============================================================\n// 1. Barb Swipe - change Toxic DoT duration 2.1 -> 3.1\n// ============================================================\nconsole.log\\('\\\\n=== 1. Barb Swipe: Toxic DoT duration 2.1 -> 3.1 ==='\\);\nfor \\(const dir of SPINES_DIRS\\) {\n  const filePath = path.join\\(dir, 'barb-swipe.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  content = applyReplace\\(\n    content, filePath,\n    '\"duration\": 2.1',\n    '\"duration\": 3.1',\n    'Toxic DoT duration 2.1 -> 3.1'\n  \\);\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\n// ============================================================\n// 2. Lunge - multiple changes\n// ============================================================\nconsole.log\\('\\\\n=== 2. Lunge: castTime, recharge, endurance, scale, duration ==='\\);\nfor \\(const dir of SPINES_DIRS\\) {\n  const filePath = path.join\\(dir, 'lunge.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  // castTime 1.63 -> 1.33\n  content = applyReplace\\(\n    content, filePath,\n    '\"castTime\": 1.63',\n    '\"castTime\": 1.33',\n    'castTime 1.63 -> 1.33'\n  \\);\n\n  // recharge 6 -> 5 \\(match exactly \"recharge\": 6,\\)\n  content = applyReplace\\(\n    content, filePath,\n    '\"recharge\": 6,',\n    '\"recharge\": 5,',\n    'recharge 6 -> 5'\n  \\);\n\n  // endurance 6.864 -> 6.032\n  content = applyReplace\\(\n    content, filePath,\n    '\"endurance\": 6.864',\n    '\"endurance\": 6.032',\n    'endurance 6.864 -> 6.032'\n  \\);\n\n  // FIRST occurrence of \"scale\": 1.32 -> 1.08 \\(Lethal Melee_Damage entry\\)\n  content = replaceFirst\\(\n    content, filePath,\n    '\"scale\": 1.32',\n    '\"scale\": 1.08',\n    'first scale 1.32 -> 1.08 \\(Lethal Melee_Damage\\)'\n  \\);\n\n  // Toxic DoT duration 3.1 -> 6.1\n  content = replaceFirst\\(\n    content, filePath,\n    '\"duration\": 3.1',\n    '\"duration\": 6.1',\n    'Toxic DoT duration 3.1 -> 6.1'\n  \\);\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\n// ============================================================\n// 3. Spine Burst - multiple changes\n// ============================================================\nconsole.log\\('\\\\n=== 3. Spine Burst: castTime, recharge, endurance, scale, duration ==='\\);\nfor \\(const dir of SPINES_DIRS\\) {\n  const filePath = path.join\\(dir, 'spine-burst.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  // castTime 3 -> 1.67 \\(match exactly \"castTime\": 3, not 3.x\\)\n  content = applyReplace\\(\n    content, filePath,\n    '\"castTime\": 3,',\n    '\"castTime\": 1.67,',\n    'castTime 3 -> 1.67'\n  \\);\n\n  // recharge 16 -> 10 \\(match exactly \"recharge\": 16,\\)\n  content = applyReplace\\(\n    content, filePath,\n    '\"recharge\": 16,',\n    '\"recharge\": 10,',\n    'recharge 16 -> 10'\n  \\);\n\n  // endurance 15.184 -> 10.192\n  content = applyReplace\\(\n    content, filePath,\n    '\"endurance\": 15.184',\n    '\"endurance\": 10.192',\n    'endurance 15.184 -> 10.192'\n  \\);\n\n  // FIRST \"scale\": 0.9 -> 0.6 \\(Lethal Melee_Damage entry\\)\n  content = replaceFirst\\(\n    content, filePath,\n    '\"scale\": 0.9',\n    '\"scale\": 0.6',\n    'first scale 0.9 -> 0.6 \\(Lethal Melee_Damage\\)'\n  \\);\n\n  // Toxic DoT duration 3.1 -> 6.1\n  content = replaceFirst\\(\n    content, filePath,\n    '\"duration\": 3.1',\n    '\"duration\": 6.1',\n    'Toxic DoT duration 3.1 -> 6.1'\n  \\);\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\n// ============================================================\n// 4. Ripper - Toxic DoT duration 4.1 -> 7.1\n// ============================================================\nconsole.log\\('\\\\n=== 4. Ripper: Toxic DoT duration 4.1 -> 7.1 ==='\\);\nfor \\(const dir of SPINES_DIRS\\) {\n  const filePath = path.join\\(dir, 'ripper.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  content = replaceFirst\\(\n    content, filePath,\n    '\"duration\": 4.1',\n    '\"duration\": 7.1',\n    'Toxic DoT duration 4.1 -> 7.1'\n  \\);\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\n// ============================================================\n// 5. Throw Spines - Toxic DoT duration 4.1 -> 7.1\n// ============================================================\nconsole.log\\('\\\\n=== 5. Throw Spines: Toxic DoT duration 4.1 -> 7.1 ==='\\);\nfor \\(const dir of SPINES_DIRS\\) {\n  const filePath = path.join\\(dir, 'throw-spines.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  content = replaceFirst\\(\n    content, filePath,\n    '\"duration\": 4.1',\n    '\"duration\": 7.1',\n    'Toxic DoT duration 4.1 -> 7.1'\n  \\);\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\n// ============================================================\n// 6. Breath of Fire \\(Scrapper/Brute/Stalker\\) - arc and castTime\n// ============================================================\nconsole.log\\('\\\\n=== 6. Breath of Fire \\(Scrapper/Brute/Stalker\\): arc 0.5236 -> 2.0944, castTime 2.67 -> 2.4 ==='\\);\nfor \\(const dir of FIERY_MELEE_NON_TANKER_DIRS\\) {\n  const filePath = path.join\\(dir, 'breath-of-fire.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  content = applyReplace\\(\n    content, filePath,\n    '\"arc\": 0.5236',\n    '\"arc\": 2.0944',\n    'arc 0.5236 -> 2.0944'\n  \\);\n\n  content = applyReplace\\(\n    content, filePath,\n    '\"castTime\": 2.67',\n    '\"castTime\": 2.4',\n    'castTime 2.67 -> 2.4'\n  \\);\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\n// ============================================================\n// 7. Breath of Fire \\(Tanker\\) - castTime and first scale\n// ============================================================\nconsole.log\\('\\\\n=== 7. Breath of Fire \\(Tanker\\): castTime 2.67 -> 2.5, scale 0.68 -> 0.7116 ==='\\);\n{\n  const filePath = path.join\\(FIERY_MELEE_TANKER_DIR, 'breath-of-fire.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  content = applyReplace\\(\n    content, filePath,\n    '\"castTime\": 2.67',\n    '\"castTime\": 2.5',\n    'castTime 2.67 -> 2.5'\n  \\);\n\n  // Replace first occurrence of \"scale\": 0.68 \\(the fire damage entry with duration 0.6\\)\n  content = replaceFirst\\(\n    content, filePath,\n    '\"scale\": 0.68',\n    '\"scale\": 0.7116',\n    'first scale 0.68 -> 0.7116 \\(fire damage with duration 0.6\\)'\n  \\);\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\n// ============================================================\n// 8. Greater Fire Sword \\(all 4 ATs\\) - remove defenseDebuff, cleanup\n// ============================================================\nconsole.log\\('\\\\n=== 8. Greater Fire Sword \\(all 4 ATs\\): remove defenseDebuff and related entries ==='\\);\nfor \\(const dir of FIERY_MELEE_DIRS\\) {\n  const filePath = path.join\\(dir, 'greater-fire-sword.ts'\\);\n  console.log\\('Processing: ' + path.relative\\(BASE, filePath\\)\\);\n  let content = fs.readFileSync\\(filePath, 'utf8'\\);\n\n  // Remove defenseDebuff from effects - replace block with empty effects\n  const effectsRegex = /\"effects\":\\\\s*\\\\{\\\\s*\"defenseDebuff\":\\\\s*\\\\{\\\\s*\"scale\":\\\\s*0\\\\.5,\\\\s*\"table\":\\\\s*\"Melee_Debuff_Def\"\\\\s*\\\\}\\\\s*\\\\}/;\n  content = applyReplace\\(\n    content, filePath,\n    effectsRegex,\n    '\"effects\": {}',\n    'remove defenseDebuff from effects'\n  \\);\n\n  // Remove \"Defense Debuff\" from allowedEnhancements\n  // Pattern: line with \"Defense Debuff\" and trailing comma + newline\n  const enhRegex = /\\\\n\\\\s*\"Defense Debuff\",?/;\n  content = applyReplace\\(\n    content, filePath,\n    enhRegex,\n    '',\n    'remove \"Defense Debuff\" from allowedEnhancements'\n  \\);\n\n  // Remove \"Accurate Defense Debuff\" from allowedSetCategories\n  const accDefDebuffRegex = /\\\\n\\\\s*\"Accurate Defense Debuff\",?/;\n  content = applyReplace\\(\n    content, filePath,\n    accDefDebuffRegex,\n    '',\n    'remove \"Accurate Defense Debuff\" from allowedSetCategories'\n  \\);\n\n  // Remove \"Defense Debuff\" from allowedSetCategories \\(there may still be one\\)\n  const defDebuffSetRegex = /\\\\n\\\\s*\"Defense Debuff\",?/;\n  content = applyReplace\\(\n    content, filePath,\n    defDebuffSetRegex,\n    '',\n    'remove \"Defense Debuff\" from allowedSetCategories'\n  \\);\n\n  // Fix shortHelp: remove \", -Defense\"\n  // The shortHelp line is: \"shortHelp\": \"Melee, DMG\\(Fire\\), -Defense\"\n  content = applyReplace\\(\n    content, filePath,\n    ', -Defense',\n    '',\n    'remove \", -Defense\" from shortHelp'\n  \\);\n\n  // Fix JSDoc comment line: there's still one \", -Defense\" in the JSDoc\n  // After first replacement of shortHelp, the JSDoc still has it\n  // Current JSDoc: \" * Melee, DMG\\(Fire\\), -Defense\"\n  if \\(content.includes\\(', -Defense'\\)\\) {\n    content = applyReplace\\(\n      content, filePath,\n      ', -Defense',\n      '',\n      'remove \", -Defense\" from JSDoc comment'\n    \\);\n  }\n\n  fs.writeFileSync\\(filePath, content, 'utf8'\\);\n}\n\nconsole.log\\('\\\\n=== DONE: ' + totalChanges + ' total changes applied ==='\\);\n\n// Self-delete\nconst scriptPath = __filename;\nconsole.log\\('\\\\nDeleting script: ' + scriptPath\\);\nfs.unlinkSync\\(scriptPath\\);\nconsole.log\\('Script deleted successfully.'\\);\nENDOFSCRIPT)",
      "Bash(git -C \"c:/Projects/CoH-Planner\" checkout -- \"src/data/powersets/scrapper/primary/electrical-melee/lightning-clap.ts\" \"src/data/powersets/brute/primary/electrical-melee/lightning-clap.ts\" \"src/data/powersets/tanker/secondary/electrical-melee/lightning-clap.ts\")",
      "Bash(/tmp/write-patch.js:*)",
      "Bash(/tmp/write-patch2.js << 'NODEEOF'\n// Write the patch script by building it line-by-line to avoid any escaping issues\nconst fs = require\\('fs'\\);\nconst target = 'c:/Projects/CoH-Planner/scripts/patch-lightning-clap.cjs';\nconst NL = '\\\\n';\n\nconst lines = [\n  \"/**\",\n  \" * patch-lightning-clap.cjs\",\n  \" * Patches Lightning Clap power files across multiple ATs.\",\n  \" */\",\n  \"const fs = require\\('fs'\\);\",\n  \"const path = require\\('path'\\);\",\n  \"\",\n  \"const BASE = path.join\\(__dirname, '..', 'src', 'data', 'powersets'\\);\",\n  \"\",\n  \"const FILES = [\",\n  \"  path.join\\(BASE, 'scrapper', 'primary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"  path.join\\(BASE, 'brute', 'primary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"  path.join\\(BASE, 'stalker', 'primary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"  path.join\\(BASE, 'tanker', 'secondary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"];\",\n  \"\",\n  \"function addToJsonArray\\(content, arrayKey, newEntries\\) {\",\n  \"  const regex = new RegExp\\(\",\n  String.raw`    '\\(\"' + arrayKey + '\":\\\\\\\\s*\\\\\\\\[\\)\\([\\\\\\\\s\\\\\\\\S]*?\\)\\(\\\\\\\\n\\\\\\\\s*\\\\\\\\]\\)'`,\n  \"  \\);\",\n  \"  const match = content.match\\(regex\\);\",\n  \"  if \\(!match\\) return { content, added: [] };\",\n  \"  let arrayBody = match[2];\",\n  \"  const added = [];\",\n  \"  for \\(const entry of newEntries\\) {\",\n  \"    if \\(!arrayBody.includes\\('\\\\\"' + entry + '\\\\\"'\\)\\) {\",\n  String.raw`      arrayBody += ',\\\\n    \"' + entry + '\"';`,\n  \"      added.push\\('\\\\\"' + entry + '\\\\\"'\\);\",\n  \"    }\",\n  \"  }\",\n  \"  if \\(added.length > 0\\) {\",\n  \"    content = content.replace\\(regex, match[1] + arrayBody + match[3]\\);\",\n  \"  }\",\n  \"  return { content, added };\",\n  \"}\",\n  \"\",\n  \"let totalPatched = 0;\",\n  \"\",\n  \"for \\(const filePath of FILES\\) {\",\n  \"  const shortName = path.relative\\(path.join\\(__dirname, '..'\\), filePath\\);\",\n  \"  if \\(!fs.existsSync\\(filePath\\)\\) {\",\n  \"    console.log\\('[SKIP] ' + shortName + ' -- file does not exist'\\);\",\n  \"    continue;\",\n  \"  }\",\n  String.raw`  console.log\\('\\\\n[PATCH] ' + shortName\\);`,\n  \"  let content = fs.readFileSync\\(filePath, 'utf-8'\\);\",\n  \"  let changes = [];\",\n  \"\",\n  \"  // 1. targetType\",\n  \"  if \\(content.includes\\('\\\\\"targetType\\\\\": \\\\\"Self\\\\\"'\\)\\) {\",\n  \"    content = content.replace\\('\\\\\"targetType\\\\\": \\\\\"Self\\\\\"', '\\\\\"targetType\\\\\": \\\\\"Foe\\\\\"'\\);\",\n  \"    changes.push\\('targetType: Self -> Foe'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 2. accuracy 0.8 -> 1\",\n  String.raw`  const accRe = /\"accuracy\":\\\\s*0\\\\.8\\\\b/;`,\n  \"  if \\(accRe.test\\(content\\)\\) {\",\n  \"    content = content.replace\\(accRe, '\\\\\"accuracy\\\\\": 1'\\);\",\n  \"    changes.push\\('accuracy: 0.8 -> 1'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 3. recharge 30 -> 15\",\n  String.raw`  const rechRe = /\"recharge\":\\\\s*30\\\\b/;`,\n  \"  if \\(rechRe.test\\(content\\)\\) {\",\n  \"    content = content.replace\\(rechRe, '\\\\\"recharge\\\\\": 15'\\);\",\n  \"    changes.push\\('recharge: 30 -> 15'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 4. damage block after maxSlots\",\n  String.raw`  const maxSlotsRe = /\"maxSlots\":\\\\s*6/;`,\n  String.raw`  const dmgRe = /\"damage\":\\\\s*\\\\{/;`,\n  \"  if \\(maxSlotsRe.test\\(content\\) && !dmgRe.test\\(content\\)\\) {\",\n  \"    content = content.replace\\(\",\n  String.raw`      /\\(\"maxSlots\":\\\\s*6\\)\\(,?\\)\\\\s*\\\\n/,`,\n  String.raw`      '$1,\\\\n  \"damage\": {\\\\n    \"type\": \"Energy\",\\\\n    \"scale\": 2.76,\\\\n    \"table\": \"Melee_Damage\"\\\\n  },\\\\n'`,\n  \"    \\);\",\n  \"    changes.push\\('Added damage block'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 5. allowedEnhancements\",\n  \"  {\",\n  \"    const result = addToJsonArray\\(content, 'allowedEnhancements', ['Damage']\\);\",\n  \"    if \\(result.added.length > 0\\) {\",\n  \"      content = result.content;\",\n  \"      changes.push\\('Added ' + result.added.join\\(', '\\) + ' to allowedEnhancements'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  // 6. allowedSetCategories\",\n  \"  {\",\n  \"    const result = addToJsonArray\\(content, 'allowedSetCategories', [\",\n  \"      'Melee AoE Damage',\",\n  \"      'Universal Damage Sets',\",\n  \"    ]\\);\",\n  \"    if \\(result.added.length > 0\\) {\",\n  \"      content = result.content;\",\n  \"      changes.push\\('Added ' + result.added.join\\(' and '\\) + ' to allowedSetCategories'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  // 7. shortHelp\",\n  \"  {\",\n  \"    const oldH = '\\\\\"shortHelp\\\\\": \\\\\"PBAoE, Foe Disorient, Knockback\\\\\"';\",\n  \"    const newH = '\\\\\"shortHelp\\\\\": \\\\\"PBAoE, DMG\\(Energy\\), Foe Disorient, Knockback\\\\\"';\",\n  \"    if \\(content.includes\\(oldH\\)\\) {\",\n  \"      content = content.replace\\(oldH, newH\\);\",\n  \"      changes.push\\('shortHelp: added DMG\\(Energy\\)'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  // 8. JSDoc\",\n  \"  {\",\n  \"    const oldC = ' * PBAoE, Foe Disorient, Knockback';\",\n  \"    const newC = ' * PBAoE, DMG\\(Energy\\), Foe Disorient, Knockback';\",\n  \"    if \\(content.includes\\(oldC\\)\\) {\",\n  \"      content = content.replace\\(oldC, newC\\);\",\n  \"      changes.push\\('JSDoc: added DMG\\(Energy\\)'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  if \\(changes.length === 0\\) {\",\n  \"    console.log\\('  No changes needed.'\\);\",\n  \"  } else {\",\n  \"    fs.writeFileSync\\(filePath, content, 'utf-8'\\);\",\n  \"    for \\(const c of changes\\) {\",\n  \"      console.log\\('  - ' + c\\);\",\n  \"    }\",\n  \"    console.log\\('  => ' + changes.length + ' change\\(s\\) written.'\\);\",\n  \"    totalPatched++;\",\n  \"  }\",\n  \"}\",\n  \"\",\n  String.raw`console.log\\('\\\\nDone. Patched ' + totalPatched + ' file\\(s\\).\\\\n'\\);`,\n];\n\nfs.writeFileSync\\(target, lines.join\\(NL\\), 'utf-8'\\);\nconsole.log\\('Patch script written to ' + target\\);\nNODEEOF)",
      "Bash(\"c:/Projects/CoH-Planner/scripts/_gen.cjs\" << 'GENEOF'\n// Generator script - creates patch-psi-melee.cjs with correct escaping\nconst fs = require\\(\"fs\"\\);\nconst path = require\\(\"path\"\\);\n\nconst NL = \"\\\\n\";\n// BSN must be literal two chars: backslash + n\n// In this source file, \"\\\\\\\\n\" is interpreted by JS as newline\n// We need the string to contain a real backslash followed by n\nconst BSN = String.fromCharCode\\(92\\) + \"n\";\n\nconst lines = [];\n\nfunction add\\(s\\) { lines.push\\(s\\); }\n\nadd\\('/**'\\);\nadd\\(' * Psionic Melee Patch Script'\\);\nadd\\(' */'\\);\nadd\\(''\\);\nadd\\('const fs = require\\(\"fs\"\\);'\\);\nadd\\('const path = require\\(\"path\"\\);'\\);\nadd\\(''\\);\nadd\\('const BASE = path.resolve\\(__dirname, \"..\", \"src\", \"data\", \"powersets\"\\);'\\);\nadd\\(''\\);\nadd\\('const AT_DIRS = ['\\);\nadd\\('  [\"scrapper\", \"primary\"],'\\);\nadd\\('  [\"brute\", \"primary\"],'\\);\nadd\\('  [\"stalker\", \"primary\"],'\\);\nadd\\('  [\"tanker\", \"secondary\"],'\\);\nadd\\('];'\\);\nadd\\(''\\);\nadd\\('let totalChanges = 0;'\\);\nadd\\(''\\);\nadd\\('function logChange\\(fp, desc\\) {'\\);\nadd\\('  const rel = path.relative\\(path.resolve\\(__dirname, \"..\"\\), fp\\);'\\);\nadd\\('  console.log\\(\"  [CHANGED] \" + rel + \": \" + desc\\);'\\);\nadd\\('  totalChanges++;'\\);\nadd\\('}'\\);\nadd\\(''\\);\nadd\\('function logSkip\\(fp, reason\\) {'\\);\nadd\\('  const rel = path.relative\\(path.resolve\\(__dirname, \"..\"\\), fp\\);'\\);\nadd\\('  console.log\\(\"  [SKIP]    \" + rel + \": \" + reason\\);'\\);\nadd\\('}'\\);\nadd\\(''\\);\nadd\\('// --- 1. Insight DoT standardization ---'\\);\nadd\\('const DOT_POWERS = ['\\);\nadd\\('  { file: \"mental-strike.ts\",    oldScale: 0.084,  newScale: 0.0661 },'\\);\nadd\\('  { file: \"psi-blade.ts\",        oldScale: 0.2285, newScale: 0.1799 },'\\);\nadd\\('  { file: \"telekinetic-blow.ts\", oldScale: 0.18,   newScale: 0.1417 },'\\);\nadd\\('  { file: \"psi-blade-sweep.ts\",  oldScale: 0.236,  newScale: 0.1858 },'\\);\nadd\\('  { file: \"mass-levitate.ts\",    oldScale: 0.142,  newScale: 0.1118 },'\\);\nadd\\('];'\\);\nadd\\(''\\);\nadd\\('console.log\\(\"' + BSN + '=== 1. Insight DoT Standardization ===\"\\);'\\);\nadd\\(''\\);\nadd\\('for \\(const [at, slot] of AT_DIRS\\) {'\\);\nadd\\('  for \\(const { file, oldScale, newScale } of DOT_POWERS\\) {'\\);\nadd\\('    const fp = path.join\\(BASE, at, slot, \"psionic-melee\", file\\);'\\);\nadd\\('    if \\(!fs.existsSync\\(fp\\)\\) { logSkip\\(fp, \"file does not exist\"\\); continue; }'\\);\nadd\\('    let c = fs.readFileSync\\(fp, \"utf8\"\\);'\\);\nadd\\('    const oldS = String\\(oldScale\\);'\\);\nadd\\('    const newS = String\\(newScale\\);'\\);\nadd\\('    // Build search/replace with actual newline chars'\\);\nadd\\(\"    const search = '\\\\\"scale\\\\\": ' + oldS + ',\" + BSN + \"      \\\\\"table\\\\\": \\\\\"Melee_Damage\\\\\",\" + BSN + \"      \\\\\"duration\\\\\": 3.1';\"\\);\nadd\\(\"    const repl = '\\\\\"scale\\\\\": ' + newS + ',\" + BSN + \"      \\\\\"table\\\\\": \\\\\"Melee_Damage\\\\\",\" + BSN + \"      \\\\\"duration\\\\\": 2.1';\"\\);\nadd\\('    if \\(c.indexOf\\(search\\) === -1\\) { logSkip\\(fp, \"no matching DoT entry \\(scale \" + oldS + \" + duration 3.1\\)\"\\); continue; }'\\);\nadd\\('    c = c.replace\\(search, repl\\);'\\);\nadd\\('    fs.writeFileSync\\(fp, c, \"utf8\"\\);'\\);\nadd\\('    logChange\\(fp, \"DoT scale \" + oldS + \" -> \" + newS + \", duration 3.1 -> 2.1\"\\);'\\);\nadd\\('  }'\\);\nadd\\('}'\\);\nadd\\(''\\);\nadd\\('// --- 2. Boggle castTime ---'\\);\nadd\\('console.log\\(\"' + BSN + '=== 2. Boggle castTime ===\"\\);'\\);\nadd\\(''\\);\nadd\\('for \\(const [at, slot] of AT_DIRS\\) {'\\);\nadd\\('  const fp = path.join\\(BASE, at, slot, \"psionic-melee\", \"boggle.ts\"\\);'\\);\nadd\\('  if \\(!fs.existsSync\\(fp\\)\\) { logSkip\\(fp, \"file does not exist\"\\); continue; }'\\);\nadd\\('  let c = fs.readFileSync\\(fp, \"utf8\"\\);'\\);\nadd\\('  // Match \"castTime\": 2 but NOT \"castTime\": 2.5'\\);\nadd\\(\"  if \\(c.indexOf\\('\\\\\"castTime\\\\\": 2,'\\) !== -1\\) {\"\\);\nadd\\(\"    c = c.replace\\('\\\\\"castTime\\\\\": 2,', '\\\\\"castTime\\\\\": 1,'\\);\"\\);\nadd\\(\"  } else if \\(c.indexOf\\('\\\\\"castTime\\\\\": 2\" + BSN + \"'\\) !== -1\\) {\"\\);\nadd\\(\"    c = c.replace\\('\\\\\"castTime\\\\\": 2\" + BSN + \"', '\\\\\"castTime\\\\\": 1\" + BSN + \"'\\);\"\\);\nadd\\('  } else {'\\);\nadd\\('    logSkip\\(fp, \"castTime is not 2 \\(already patched or different\\)\"\\);'\\);\nadd\\('    continue;'\\);\nadd\\('  }'\\);\nadd\\('  fs.writeFileSync\\(fp, c, \"utf8\"\\);'\\);\nadd\\('  logChange\\(fp, \"castTime 2 -> 1\"\\);'\\);\nadd\\('}'\\);\nadd\\(''\\);\nadd\\('// --- 3. Greater Psi Blade ---'\\);\nadd\\('console.log\\(\"' + BSN + '=== 3. Greater Psi Blade ===\"\\);'\\);\nadd\\(''\\);\nadd\\('for \\(const [at, slot] of AT_DIRS\\) {'\\);\nadd\\('  const fp = path.join\\(BASE, at, slot, \"psionic-melee\", \"greater-psi-blade.ts\"\\);'\\);\nadd\\('  if \\(!fs.existsSync\\(fp\\)\\) { logSkip\\(fp, \"file does not exist\"\\); continue; }'\\);\nadd\\('  let c = fs.readFileSync\\(fp, \"utf8\"\\);'\\);\nadd\\('  let changed = false;'\\);\nadd\\(''\\);\nadd\\('  // 3a. scale 1.38 -> 1.656'\\);\nadd\\(\"  if \\(c.indexOf\\('\\\\\"scale\\\\\": 1.38,'\\) !== -1\\) {\"\\);\nadd\\(\"    c = c.replace\\('\\\\\"scale\\\\\": 1.38,', '\\\\\"scale\\\\\": 1.656,'\\);\"\\);\nadd\\('    logChange\\(fp, \"Insight Psionic scale 1.38 -> 1.656\"\\);'\\);\nadd\\('    changed = true;'\\);\nadd\\('  } else {'\\);\nadd\\('    logSkip\\(fp, \"Insight scale is not 1.38 \\(already patched or different\\)\"\\);'\\);\nadd\\('  }'\\);\nadd\\(''\\);\nadd\\('  // 3b. Hold mag 3 -> 1 \\(only inside hold block\\)'\\);\nadd\\(\"  const holdIdx = c.indexOf\\('\\\\\"hold\\\\\":'\\);\"\\);\nadd\\('  if \\(holdIdx !== -1\\) {'\\);\nadd\\('    const afterHold = c.substring\\(holdIdx\\);'\\);\nadd\\('    const closeBrace = afterHold.indexOf\\(\"}\"\\);'\\);\nadd\\('    const holdBlock = afterHold.substring\\(0, closeBrace + 1\\);'\\);\nadd\\(\"    if \\(holdBlock.indexOf\\('\\\\\"mag\\\\\": 3'\\) !== -1\\) {\"\\);\nadd\\(\"      const newBlock = holdBlock.replace\\('\\\\\"mag\\\\\": 3', '\\\\\"mag\\\\\": 1'\\);\"\\);\nadd\\('      c = c.substring\\(0, holdIdx\\) + newBlock + afterHold.substring\\(closeBrace + 1\\);'\\);\nadd\\('      logChange\\(fp, \"hold mag 3 -> 1\"\\);'\\);\nadd\\('      changed = true;'\\);\nadd\\('    } else {'\\);\nadd\\('      logSkip\\(fp, \"hold mag is not 3 \\(already patched or different\\)\"\\);'\\);\nadd\\('    }'\\);\nadd\\('  } else {'\\);\nadd\\('    logSkip\\(fp, \"no hold block found\"\\);'\\);\nadd\\('  }'\\);\nadd\\(''\\);\nadd\\('  if \\(changed\\) { fs.writeFileSync\\(fp, c, \"utf8\"\\); }'\\);\nadd\\('}'\\);\nadd\\(''\\);\nadd\\('console.log\\(\"' + BSN + 'Done. Total changes applied: \" + totalChanges\\);'\\);\n\nconst output = lines.join\\(NL\\) + NL;\nconst outPath = path.join\\(__dirname, \"patch-psi-melee.cjs\"\\);\nfs.writeFileSync\\(outPath, output, \"utf8\"\\);\nconsole.log\\(\"Generated patch-psi-melee.cjs \\(\" + output.length + \" bytes\\)\"\\);\nGENEOF)",
      "Bash(/tmp/test-regex.js:*)",
      "Bash(powershell.exe -NoProfile -ExecutionPolicy Bypass -File NUL -Command \"& { [System.IO.File]::WriteAllText\\(''C:\\\\Projects\\\\CoH-Planner\\\\scripts\\\\gen-patch.js'', ''console.log\\(42\\);''\\); }\")",
      "Bash(powershell.exe -NoProfile -ExecutionPolicy Bypass -Command \"[System.IO.File]::WriteAllText\\(''C:\\\\Projects\\\\CoH-Planner\\\\scripts\\\\gen-patch.js'', ''console.log\\(42\\);''\\)\")",
      "Bash(/tmp/write-patch3.js << 'NODEEOF'\nconst fs = require\\('fs'\\);\nconst target = 'c:/Projects/CoH-Planner/scripts/patch-lightning-clap.cjs';\nconst NL = '\\\\n';\n\nconst lines = [\n  \"/**\",\n  \" * patch-lightning-clap.cjs\",\n  \" * Patches Lightning Clap power files across multiple ATs.\",\n  \" */\",\n  \"const fs = require\\('fs'\\);\",\n  \"const path = require\\('path'\\);\",\n  \"\",\n  \"const BASE = path.join\\(__dirname, '..', 'src', 'data', 'powersets'\\);\",\n  \"\",\n  \"const FILES = [\",\n  \"  path.join\\(BASE, 'scrapper', 'primary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"  path.join\\(BASE, 'brute', 'primary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"  path.join\\(BASE, 'stalker', 'primary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"  path.join\\(BASE, 'tanker', 'secondary', 'electrical-melee', 'lightning-clap.ts'\\),\",\n  \"];\",\n  \"\",\n  \"function addToJsonArray\\(content, arrayKey, newEntries\\) {\",\n  \"  // Find the array start\",\n  '  const startMarker = \\\\'\\\\\"\\\\\\\\' + arrayKey + \\\\'\\\\\":\\\\';',\n  \"  const startIdx = content.indexOf\\(startMarker\\);\",\n  \"  if \\(startIdx === -1\\) return { content, added: [] };\",\n  \"  const bracketOpen = content.indexOf\\('[', startIdx\\);\",\n  \"  if \\(bracketOpen === -1\\) return { content, added: [] };\",\n  \"  const bracketClose = content.indexOf\\(']', bracketOpen\\);\",\n  \"  if \\(bracketClose === -1\\) return { content, added: [] };\",\n  \"\",\n  \"  let arrayContent = content.substring\\(bracketOpen + 1, bracketClose\\);\",\n  \"  const added = [];\",\n  \"  for \\(const entry of newEntries\\) {\",\n  \"    if \\(!arrayContent.includes\\('\\\\\"' + entry + '\\\\\"'\\)\\) {\",\n  '      arrayContent += \\\\',\\\\\\\\n    \"\\\\' + entry + \\\\'\"\\\\';',\n  \"      added.push\\('\\\\\"' + entry + '\\\\\"'\\);\",\n  \"    }\",\n  \"  }\",\n  \"  if \\(added.length > 0\\) {\",\n  \"    content = content.substring\\(0, bracketOpen + 1\\) + arrayContent + content.substring\\(bracketClose\\);\",\n  \"  }\",\n  \"  return { content, added };\",\n  \"}\",\n  \"\",\n  \"let totalPatched = 0;\",\n  \"\",\n  \"for \\(const filePath of FILES\\) {\",\n  \"  const shortName = path.relative\\(path.join\\(__dirname, '..'\\), filePath\\);\",\n  \"  if \\(!fs.existsSync\\(filePath\\)\\) {\",\n  \"    console.log\\('[SKIP] ' + shortName + ' -- file does not exist'\\);\",\n  \"    continue;\",\n  \"  }\",\n  String.raw`  console.log\\('\\\\n[PATCH] ' + shortName\\);`,\n  \"  let content = fs.readFileSync\\(filePath, 'utf-8'\\);\",\n  \"  let changes = [];\",\n  \"\",\n  \"  // 1. targetType\",\n  \"  if \\(content.includes\\('\\\\\"targetType\\\\\": \\\\\"Self\\\\\"'\\)\\) {\",\n  \"    content = content.replace\\('\\\\\"targetType\\\\\": \\\\\"Self\\\\\"', '\\\\\"targetType\\\\\": \\\\\"Foe\\\\\"'\\);\",\n  \"    changes.push\\('targetType: Self -> Foe'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 2. accuracy 0.8 -> 1\",\n  String.raw`  const accRe = /\"accuracy\":\\\\s*0\\\\.8\\\\b/;`,\n  \"  if \\(accRe.test\\(content\\)\\) {\",\n  \"    content = content.replace\\(accRe, '\\\\\"accuracy\\\\\": 1'\\);\",\n  \"    changes.push\\('accuracy: 0.8 -> 1'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 3. recharge 30 -> 15\",\n  String.raw`  const rechRe = /\"recharge\":\\\\s*30\\\\b/;`,\n  \"  if \\(rechRe.test\\(content\\)\\) {\",\n  \"    content = content.replace\\(rechRe, '\\\\\"recharge\\\\\": 15'\\);\",\n  \"    changes.push\\('recharge: 30 -> 15'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 4. damage block after maxSlots\",\n  String.raw`  const maxSlotsRe = /\"maxSlots\":\\\\s*6/;`,\n  String.raw`  const dmgRe = /\"damage\":\\\\s*\\\\{/;`,\n  \"  if \\(maxSlotsRe.test\\(content\\) && !dmgRe.test\\(content\\)\\) {\",\n  \"    content = content.replace\\(\",\n  String.raw`      /\\(\"maxSlots\":\\\\s*6\\)\\(,?\\)\\\\s*\\\\n/,`,\n  String.raw`      '$1,\\\\n  \"damage\": {\\\\n    \"type\": \"Energy\",\\\\n    \"scale\": 2.76,\\\\n    \"table\": \"Melee_Damage\"\\\\n  },\\\\n'`,\n  \"    \\);\",\n  \"    changes.push\\('Added damage block'\\);\",\n  \"  }\",\n  \"\",\n  \"  // 5. allowedEnhancements\",\n  \"  {\",\n  \"    const result = addToJsonArray\\(content, 'allowedEnhancements', ['Damage']\\);\",\n  \"    if \\(result.added.length > 0\\) {\",\n  \"      content = result.content;\",\n  \"      changes.push\\('Added ' + result.added.join\\(', '\\) + ' to allowedEnhancements'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  // 6. allowedSetCategories\",\n  \"  {\",\n  \"    const result = addToJsonArray\\(content, 'allowedSetCategories', [\",\n  \"      'Melee AoE Damage',\",\n  \"      'Universal Damage Sets',\",\n  \"    ]\\);\",\n  \"    if \\(result.added.length > 0\\) {\",\n  \"      content = result.content;\",\n  \"      changes.push\\('Added ' + result.added.join\\(' and '\\) + ' to allowedSetCategories'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  // 7. shortHelp\",\n  \"  {\",\n  \"    const oldH = '\\\\\"shortHelp\\\\\": \\\\\"PBAoE, Foe Disorient, Knockback\\\\\"';\",\n  \"    const newH = '\\\\\"shortHelp\\\\\": \\\\\"PBAoE, DMG\\(Energy\\), Foe Disorient, Knockback\\\\\"';\",\n  \"    if \\(content.includes\\(oldH\\)\\) {\",\n  \"      content = content.replace\\(oldH, newH\\);\",\n  \"      changes.push\\('shortHelp: added DMG\\(Energy\\)'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  // 8. JSDoc\",\n  \"  {\",\n  \"    const oldC = ' * PBAoE, Foe Disorient, Knockback';\",\n  \"    const newC = ' * PBAoE, DMG\\(Energy\\), Foe Disorient, Knockback';\",\n  \"    if \\(content.includes\\(oldC\\)\\) {\",\n  \"      content = content.replace\\(oldC, newC\\);\",\n  \"      changes.push\\('JSDoc: added DMG\\(Energy\\)'\\);\",\n  \"    }\",\n  \"  }\",\n  \"\",\n  \"  if \\(changes.length === 0\\) {\",\n  \"    console.log\\('  No changes needed.'\\);\",\n  \"  } else {\",\n  \"    fs.writeFileSync\\(filePath, content, 'utf-8'\\);\",\n  \"    for \\(const c of changes\\) {\",\n  \"      console.log\\('  - ' + c\\);\",\n  \"    }\",\n  \"    console.log\\('  => ' + changes.length + ' change\\(s\\) written.'\\);\",\n  \"    totalPatched++;\",\n  \"  }\",\n  \"}\",\n  \"\",\n  String.raw`console.log\\('\\\\nDone. Patched ' + totalPatched + ' file\\(s\\).\\\\n'\\);`,\n];\n\nfs.writeFileSync\\(target, lines.join\\(NL\\), 'utf-8'\\);\nconsole.log\\('Patch script written to ' + target\\);\nNODEEOF)",
      "Bash(del \"c:\\\\Projects\\\\CoH-Planner\\\\scripts\\\\patch-remaining.cjs\" \"c:\\\\Projects\\\\CoH-Planner\\\\scripts\\\\patch-sonic-desc.cjs\")",
      "Bash(/tmp/detailed_analysis.md:*)",
      "Bash(/tmp/simulate_lookup.txt:*)",
      "Bash(cat:*)",
      "Bash(/tmp/final_analysis.md:*)",
      "Bash(/tmp/FINDINGS.md:*)"
    ]
  }
}
